(function(){"use strict";var e={4097:function(e,t,n){var o=n(5130),i=n(6768);const s={style:{"margin-top":"1rem"}};function l(e,t,n,o,l,a){const c=(0,i.g2)("HomeView"),r=(0,i.g2)("ChatView");return(0,i.uX)(),(0,i.CE)("main",s,[this.showHome?((0,i.uX)(),(0,i.Wv)(c,{key:0,peerId:this.peerId,online:this.online,connections:this.connections,onDeleteConn:t[0]||(t[0]=e=>{this.deleteConn(e)}),onAddNewConnection:t[1]||(t[1]=(e,t)=>this.addNewConnection(e,t)),onSelectedChat:t[2]||(t[2]=e=>a.handleChatSelected(e)),onProfileUpdate:t[3]||(t[3]=e=>this.profile=e)},null,8,["peerId","online","connections"])):this.selectedChat?((0,i.uX)(),(0,i.Wv)(r,{key:this.selectedChat.conn.connectionId,conn:this.selectedChat,onUpdateMessages:t[4]||(t[4]=e=>{this.selectedChat.messages=e}),onReConnect:t[5]||(t[5]=e=>this.reConnect(e)),onEditName:t[6]||(t[6]=e=>this.editName(e)),onPlaySound:this.playSound},null,8,["conn","onPlaySound"])):(0,i.Q3)("",!0)])}n(4114);var a=n.p+"media/new-notification-7-210334.018d07b5.mp3",c=n(4232);const r=e=>((0,i.Qi)("data-v-3c7c8883"),e=e(),(0,i.jt)(),e),h={class:"container"},d=r((()=>(0,i.Lk)("p",{style:{margin:"0"}},"Your ID",-1))),p={style:{display:"flex","justify-content":"space-between","align-items":"center"}},u=r((()=>(0,i.Lk)("i",{class:"fas fa-copy"},null,-1))),m={key:0},f={key:0},g=r((()=>(0,i.Lk)("i",{class:"fas fa-pen"},null,-1))),b=[g],k={key:1},C=r((()=>(0,i.Lk)("i",{class:"fa fa-refresh"},null,-1))),y=[C],v=r((()=>(0,i.Lk)("i",{class:"fas fa-add"},null,-1))),w=[v],I={style:{"margin-top":"2vh"},class:"container"},L=r((()=>(0,i.Lk)("h1",null,"Chats",-1))),_=["onClick","onContextmenu"],P={class:"grid",style:{"justify-content":"space-between"}},x={key:0,style:{display:"inline"}},S={key:0},D=r((()=>(0,i.Lk)("i",{class:"fas fa-link"},null,-1))),E=[D],$={key:1},j=r((()=>(0,i.Lk)("mark",null,"New",-1))),N=[j],O={style:{"font-size":"80%",color:"#fff3",margin:"0"}},X={style:{"margin-bottom":"3px",color:"#fff5"},class:"grid"};function M(e,t,n,s,l,a){const r=(0,i.g2)("SearchModal");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.Lk)("div",h,[d,(0,i.Lk)("div",p,[(0,i.Lk)("div",null,[(0,i.Lk)("code",null,(0,c.v_)(this.peerId),1),(0,i.Lk)("span",{id:"copy-id",onClick:t[0]||(t[0]=(...e)=>this.copyPeerId&&this.copyPeerId(...e))},[u,(0,i.eW)(" Â  "),this.copied?((0,i.uX)(),(0,i.CE)("code",m,"Copied!")):(0,i.Q3)("",!0)])]),this.publicProfile?((0,i.uX)(),(0,i.CE)("hgroup",f,[(0,i.Lk)("h4",null,(0,c.v_)(l.publicProfile.username),1),(0,i.Lk)("p",null,[(0,i.Lk)("a",{href:"#",onClick:t[1]||(t[1]=(...e)=>this.changeName&&this.changeName(...e))},b),(0,i.eW)(" "+(0,c.v_)(l.publicProfile.name),1)])])):((0,i.uX)(),(0,i.CE)("div",k,[(0,i.Lk)("button",{onClick:t[2]||(t[2]=e=>this.makePublicProfile(this.peerId)),style:{padding:"5px",margin:"0 3px","font-size":"80%"}},"Make Public"),(0,i.Lk)("a",{onClick:t[3]||(t[3]=(...e)=>this.getPublicProfile&&this.getPublicProfile(...e))},y)]))]),(0,i.Lk)("span",null,(0,c.v_)(this.online?"Online":"Offline"),1),(0,i.Lk)("button",{onClick:t[4]||(t[4]=e=>this.openModal=!0),id:"add-new"},w)]),(0,i.Lk)("div",I,[L,((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(this.connections,((e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t},[(0,i.Lk)("button",{onClick:e=>this.$emit("selectedChat",t),style:{width:"100%",margin:"10px 0","text-align":"start"},onContextmenu:(0,o.D$)((e=>this.deleteConn(t)),["prevent"])},[(0,i.Lk)("div",P,[(0,i.Lk)("div",null,[(0,i.Lk)("b",null,[(0,i.eW)((0,c.v_)(e.title||e.peerId)+" ",1),e?((0,i.uX)(),(0,i.CE)("div",x,[e.new?((0,i.uX)(),(0,i.CE)("span",S,E)):(0,i.Q3)("",!0),e.newMsg?((0,i.uX)(),(0,i.CE)("span",$,N)):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0)]),(0,i.Lk)("p",O,[(0,i.Lk)("em",null,(0,c.v_)(e.peerId),1)]),(0,i.Lk)("p",X,(0,c.v_)(this.lastmsg(t)),1)])])],40,_)])))),128))]),(0,i.bF)(r,{open:this.openModal,onAddNewConnection:t[5]||(t[5]=(e,t)=>this.addNewConnection(e,t)),onClose:t[6]||(t[6]=e=>this.openModal=!1)},null,8,["open"])],64)}var T=n(5756);const A=["open"],W=(0,i.Lk)("p",null,[(0,i.Lk)("strong",null,[(0,i.Lk)("i",{class:"fas fa-compass"}),(0,i.eW)(" Add")])],-1),Q=["disabled"],H=(0,i.Lk)("label",null,"or",-1),U=["disabled"],B=(0,i.Lk)("button",{type:"submit"},"Add",-1);function J(e,t,n,s,l,a){return(0,i.uX)(),(0,i.CE)("dialog",{ref:"modal",open:this.open},[(0,i.Lk)("article",null,[(0,i.Lk)("header",null,[(0,i.Lk)("button",{onClick:t[0]||(t[0]=e=>this.$emit("close")),"aria-label":"Close",rel:"prev"}),W]),(0,i.Lk)("form",{onSubmit:t[3]||(t[3]=(0,o.D$)(((...e)=>this.addConn&&this.addConn(...e)),["prevent"]))},[(0,i.Lk)("fieldset",null,[(0,i.bo)((0,i.Lk)("input",{type:"text",placeholder:"Username","onUpdate:modelValue":t[1]||(t[1]=e=>this.username=e),disabled:""!=this.peerId},null,8,Q),[[o.Jo,this.username]]),H,(0,i.bo)((0,i.Lk)("input",{type:"text",placeholder:"Peer ID","onUpdate:modelValue":t[2]||(t[2]=e=>this.peerId=e),disabled:""!=this.username},null,8,U),[[o.Jo,this.peerId]]),B])],32)])],8,A)}var V={props:["open"],data(){return{username:"",peerId:""}},methods:{addConn(){""===this.username&&""===this.peerId||this.$emit("addNewConnection",this.username,this.peerId)}}},F=n(1241);const K=(0,F.A)(V,[["render",J]]);var z=K,G={data(){return{copied:!1,appwrite_client:null,dbCLient:null,public:!1,publicProfile:!1,openModal:!1}},emits:["addNewConnection","deleteConn","selectedChat"],props:["peerId","connections","online"],components:{SearchModal:z},methods:{changeName(){let e=prompt("Enter your new name");e&&this.dbCLient.updateDocument("664be0cd0025681b946f","6693a99c000b98aa8af0",this.publicProfile.$id,{name:e}).then((e=>{this.publicProfile=e,this.$emit("profileUpdate",e)})).catch((e=>{alert(e.message)}))},initAppwrite(){const e=new T.Kj;return e.setEndpoint("https://cloud.appwrite.io/v1").setProject("664be05c000260735ae6"),e},copyPeerId(){navigator.clipboard.writeText(this.peerId),this.copied=!0,setTimeout((()=>{this.copied=!1}),2e3)},async addNewConnection(e,t){let n=null,o=null;if(e)try{let t=await this.dbCLient.getDocument("664be0cd0025681b946f","6693a99c000b98aa8af0",e);n=t.peerId,o=t.name,this.$emit("addNewConnection",n,o)}catch(i){alert("User not found")}finally{this.openModal=!1}else n=t,this.openModal=!1,this.$emit("addNewConnection",n,o)},deleteConn(e){let t=window.confirm("Are you sure you want to delete this connection?");t&&this.$emit("deleteConn",e)},lastmsg(e){let t=this.connections[e];if(t.messages.length>0){let e=t.messages[t.messages.length-1];return`${e.self?"You: ":""}${e.text.length>20?e.text.slice(0,20)+"...":e.text}`}return""},async makePublicProfile(e){let t=prompt("Do you want to make yourself public? (This will allow others to find you by your ID). If yes please enter your public username.");t?this.dbCLient.createDocument("664be0cd0025681b946f","6693a99c000b98aa8af0",t,{peerId:e,created:new Date,username:t,name:t}).then((e=>{console.log(e),localStorage.setItem("nitchat30095069_isPublic",JSON.stringify(e)),this.publicProfile=e,this.$emit("profileUpdate",e)})).catch((e=>{alert(e.message)})):localStorage.setItem("nitchat30095069_isPublic_pref",!1)},async getPublicProfile(){let e=await this.dbCLient.listDocuments("664be0cd0025681b946f","6693a99c000b98aa8af0",[T.XK.equal("peerId",this.peerId)]);e.documents.length>0?this.publicProfile=e.documents[0]:this.publicProfile=!1}},async created(){let e=localStorage.getItem("nitchat30095069_isPublic");if(this.appwrite_client=this.initAppwrite(),this.dbCLient=new T.Lv(this.appwrite_client),e)this.publicProfile=JSON.parse(e);else{let e=localStorage.getItem("nitchat30095069_isPublic_pref");if("false"===e)return;this.peerId&&this.makePublicProfile(this.peerId)}}};const R=(0,F.A)(G,[["render",M],["__scopeId","data-v-3c7c8883"]]);var Y=R;const q=e=>((0,i.Qi)("data-v-3b9e3ac4"),e=e(),(0,i.jt)(),e),Z={class:"container",style:{position:"relative"}},ee=q((()=>(0,i.Lk)("i",{class:"fas fa-pen"},null,-1))),te=[ee],ne=q((()=>(0,i.Lk)("i",{class:"fas fa-refresh"},null,-1))),oe={style:{position:"relative",height:"85dvh"}},ie={class:"chat-box",ref:"chatBox"},se={id:"text-box"},le={class:"text"},ae=q((()=>(0,i.Lk)("br",null,null,-1))),ce={class:"time"},re={key:0},he={style:{position:"absolute",bottom:"0",width:"100%"}},de={role:"group"},pe=q((()=>(0,i.Lk)("i",{class:"fas fa-paper-plane"},null,-1))),ue=[pe];function me(e,t,n,s,l,a){const r=(0,i.g2)("GreenDot");return(0,i.uX)(),(0,i.CE)("div",Z,[(0,i.Lk)("header",null,[(0,i.Lk)("hgroup",null,[(0,i.Lk)("h5",null,[(0,i.eW)((0,c.v_)(this.conn.title||this.conn.peerId)+" ",1),(0,i.Lk)("button",{style:{scale:"0.7"},onClick:t[0]||(t[0]=e=>this.$emit("editName",this.conn.peerId))},te)]),(0,i.Lk)("p",null,[this.online?((0,i.uX)(),(0,i.Wv)(r,{key:0})):(0,i.Q3)("",!0),(0,i.eW)(" "+(0,c.v_)(this.online?"Online":"Offline"),1)]),this.online?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("a",{key:0,href:"#",onClick:t[1]||(t[1]=e=>this.$emit("reConnect",this.conn.peerId))},[(0,i.eW)("Reconnect "),ne]))])]),(0,i.Lk)("main",oe,[(0,i.Lk)("div",ie,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(this.messages,((e,t)=>((0,i.uX)(),(0,i.CE)("p",{key:t,class:(0,c.C4)({self:e.self,other:!e.self})},[(0,i.Lk)("span",se,[(0,i.Lk)("span",le,(0,c.v_)(e.text),1),ae,(0,i.Lk)("span",ce,[(0,i.eW)((0,c.v_)(new Date(e.timestamp).toLocaleTimeString())+" ",1),(new Date).toDateString()!=new Date(e.timestamp).toDateString()?((0,i.uX)(),(0,i.CE)("span",re,(0,c.v_)(new Date(e.timestamp).toLocaleDateString()),1)):(0,i.Q3)("",!0)])])],2)))),128))],512),(0,i.Lk)("div",he,[(0,i.Lk)("fieldset",de,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>this.message=e),type:"text",placeholder:"Type a message",ref:"messageInp"},null,512),[[o.Jo,this.message]]),(0,i.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>this.send_message&&this.send_message(...e))},ue)])])])])}function fe(e,t,n,o,s,l){return(0,i.uX)(),(0,i.CE)("div",{style:(0,c.Tr)({backgroundColor:this.color?this.color:"green"})},null,4)}var ge={props:["color"]};const be=(0,F.A)(ge,[["render",fe],["__scopeId","data-v-43d9352d"]]);var ke=be,Ce={props:["conn"],components:{GreenDot:ke},data(){return{message:"",messages:[],online:!1}},watch:{messages:{handler(){this.$emit("updateMessages",this.messages)},deep:!0},conn:{handler(){this.online=this.conn.conn.open},deep:!0,immediate:!0}},methods:{send_message(){this.online?(this.conn.conn.send(this.message),this.messages.push({text:this.message,self:!0,timestamp:(new Date).getTime()}),this.$emit("playSound"),this.message="",this.$refs.messageInp.focus()):this.$emit("reConnect",this.conn.peerId)},scrollToBottom(){this.$refs.chatBox.scrollTo(0,this.$refs.chatBox.clientHeight+this.$refs.chatBox.scrollHeight)}},updated(){this.scrollToBottom()},created(){this.messages=this.conn.messages,this.conn.conn.on("data",(e=>{this.messages.push({text:e,self:!1,timestamp:(new Date).getTime()}),this.$emit("playSound",this.conn.peerId)})),this.conn.conn.open?this.online=!0:this.conn.conn.on("open",(()=>{this.online=!0})),this.conn.conn.on("close",(()=>{this.online=!1})),this.conn.conn.on("error",(()=>{this.online=!1})),this.conn.conn.on("disconnected",(()=>{this.online=!1}))},mounted(){this.scrollToBottom()},unmouted(){this.conn.conn.close()}};const ye=(0,F.A)(Ce,[["render",me],["__scopeId","data-v-3b9e3ac4"]]);var ve=ye,we=n(4933),Ie={name:"App",data(){return{selectedChat:null,peer_obj:null,peerId:null,online:!1,connections:[],showHome:!0,profile:null}},components:{HomeView:Y,ChatView:ve},watch:{connections:{handler(){let e=this.connections.map((e=>({peerId:e.peerId,messages:e.messages,title:e.title})));localStorage.setItem("nitchat30095069_connections",JSON.stringify(e))},deep:!0}},created(){this.getLocalConnections();let e=localStorage.getItem("nitchat30095069_peerId");e?(this.peerId=e,this.peer_obj=new we.xM(e)):(this.peer_obj=new we.xM,this.peer_obj.on("open",(e=>{this.peerId=e,localStorage.setItem("nitchat30095069_peerId",e)}))),this.peer_obj.on("open",(e=>{this.online=!0,this.peerId=e})),this.peer_obj.on("connection",(e=>{let t=this.connections.find((t=>t.peerId===e.peer));t?(t.conn=e,t.new=!0):(this.connections.push({conn:e,peerId:e.peer,messages:[],new:!0,title:e.metadata.name}),t=this.connections.find((t=>t.peerId===e.peer))),e.on("data",(e=>{this.showHome&&(t.newMsg=!0,t.messages.push({text:e,self:!1,timestamp:(new Date).getTime()}),this.playSound())}))}))},methods:{deleteConn(e){this.selectedChat&&this.selectedChat.peerId===this.connections[e].peerId&&(this.showHome=!0,this.selectedChat=null),this.connections[e].conn&&this.connections[e].open&&this.connections[e].conn.close(),this.connections.splice(e,1)},getLocalConnections(){let e=localStorage.getItem("nitchat30095069_connections");e&&(this.connections=JSON.parse(e).map((e=>({conn:null,peerId:e.peerId,messages:e.messages,title:e.title}))))},addNewConnection(e,t){console.log("here"),console.log(e,t),e&&this.connections.push({conn:null,peerId:e,messages:[],title:t||e})},handleChatSelected(e){this.showHome=!1;let t=this.connections[e];t.new&&(t.new=!1),t.conn&&t.conn.open?this.selectedChat=t:(t.conn=this.peer_obj.connect(t.peerId,{metadata:{name:this.profile?this.profile.name:this.peerId}}),t.conn.on("error",(e=>{alert("An error occured while connecting to the peer",e)}))),this.selectedChat=this.connections[e]},playSound(){let e=new Audio(a);e.play()},reConnect(e){let t=this.connections.find((t=>t.peerId===e));t.conn&&t.conn.open?this.selectedChat=t:(t.conn=this.peer_obj.connect(t.peerId),t.conn.on("error",(e=>{alert("Can't connect to the peer. Peer might be offline.",e.type)})))},editName(e){let t=prompt("Enter the new name");if(!t)return;let n=this.connections.find((t=>t.peerId===e));n.title=t}}};const Le=(0,F.A)(Ie,[["render",l]]);var _e=Le,Pe=n(3497),xe=n.n(Pe);xe().init(),(0,o.Ef)(_e).mount("#app")}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,n),s.exports}n.m=e,function(){var e=[];n.O=function(t,o,i,s){if(!o){var l=1/0;for(h=0;h<e.length;h++){o=e[h][0],i=e[h][1],s=e[h][2];for(var a=!0,c=0;c<o.length;c++)(!1&s||l>=s)&&Object.keys(n.O).every((function(e){return n.O[e](o[c])}))?o.splice(c--,1):(a=!1,s<l&&(l=s));if(a){e.splice(h--,1);var r=i();void 0!==r&&(t=r)}}return t}s=s||0;for(var h=e.length;h>0&&e[h-1][2]>s;h--)e[h]=e[h-1];e[h]=[o,i,s]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p="/nitchat/"}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var i,s,l=o[0],a=o[1],c=o[2],r=0;if(l.some((function(t){return 0!==e[t]}))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(c)var h=c(n)}for(t&&t(o);r<l.length;r++)s=l[r],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(h)},o=self["webpackChunknitchat"]=self["webpackChunknitchat"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[504],(function(){return n(4097)}));o=n.O(o)})();
//# sourceMappingURL=app.45689b5d.js.map